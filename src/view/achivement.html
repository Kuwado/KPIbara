<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KPIbara</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
        rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" href="/src/css/styles.css">
    <link rel="stylesheet" href="/src/css/achivement.css">

</head>

<body>
    <!----------------------------------------------Start header---------------------------------------------->
    <header class="container-fluid header">
        <div id="sidebar">
            <a href="/src/view/home.html" class="sidebar-item"><i class="fa-solid fa-house"></i></a>
            <a href="/src/view/viewkpi.html" class="sidebar-item" id="kpi"><i class="fa-solid fa-chart-simple"></i></a>
            <a href="/src/view/task.html" class="sidebar-item"><i class="fa-solid fa-list-check"></i></a>
            <a href="/src/view/achivement.html" class="sidebar-item active"><i class="fa-solid fa-trophy"></i></a>
        </div>

        <div id="left-header">
            <div id="logo">
                <img src="/src/images/logo.png">
            </div>
            <div id="menu">
                <a href="/src/view/home.html" class="menu-item"><i class="fa-solid fa-house"></i><span>Trang
                        chủ</span></a>
                <div class="position-relative">
                    <a href="/src/view/viewkpi.html" class="menu-item" id="kpi"><i
                            class="fa-solid fa-chart-simple"></i><span>KPI</span></a>
                    <ul class="kpi-list">
                        <li><a href="/src/view/viewkpi.html"><i class="fa-solid fa-clipboard-list"></i><span>Danh sách
                                    KPI</span></a></li>
                        <li><a href="/src/view/makekpi.html"><i class="fa-solid fa-plus"></i><span>Thiết lập
                                    KPI</span></a></li>
                    </ul>
                </div>
                <a href="/src/view/task.html" class="menu-item"><i class="fa-solid fa-list-check"></i><span>Công
                        việc</span></a>
                <a href="/src/view/achivement.html" class="menu-item active"><i
                        class="fa-solid fa-trophy"></i><span>Thành tựu</span></a>
            </div>
        </div>

        <div id="right-header">
            <button class="right-item btn right-icon"><i class="fa-solid fa-circle-question"></i></button>
            <div class="position-relative right-icon">
                <button class="right-item btn position-relative notice-btn" onclick="showNotice()">
                    <i class="fa-solid fa-bell"></i>
                    <span class="position-absolute translate-middle badge bg-primary" id="notice-number">12</span>
                </button>
                <div id="notice">
                    <div id="notice-list">
                        <a href="#"><i class="fa-solid fa-clock"></i><span>Còn 5 phút nữa tới giờ thực hiện "Chạy
                                bộ"</span></a>
                        <a href="#"><i class="fa-solid fa-circle-check"></i><span>Chúc mừng bạn đã hoàn thành xong kpi
                                "Haha"</span></a>
                        <a href="#"><i class="fa-solid fa-circle-exclamation"></i><span>Bạn đã không thực hiện "Học
                                UxUi"</span></a>
                        <a href="#" class="active"><i class="fa-solid fa-clock"></i><span>Còn 5 phút nữa tới giờ thực
                                hiện "Chạy bộ"</span></a>
                        <a href="#" class="active"><i class="fa-solid fa-circle-check"></i><span>Chúc mừng bạn đã hoàn
                                thành xong kpi "Haha"</span></a>
                        <a href="#" class="active"><i class="fa-solid fa-circle-exclamation"></i><span>Bạn đã không thực
                                hiện "Học UxUi"</span></a>
                        <a href="#" class="active"><i class="fa-solid fa-clock"></i><span>Còn 5 phút nữa tới giờ thực
                                hiện "Chạy bộ"</span></a>
                        <a href="#" class="active"><i class="fa-solid fa-circle-check"></i><span>Chúc mừng bạn đã hoàn
                                thành xong kpi "Haha"</span></a>
                        <a href="#"><i class="fa-solid fa-circle-exclamation"></i><span>Bạn đã không thực hiện "Học
                                UxUi"</span></a>
                        <a href="#"><i class="fa-solid fa-clock"></i><span>Còn 5 phút nữa tới giờ thực hiện "Chạy
                                bộ"</span></a>
                        <a href="#" class="active"><i class="fa-solid fa-circle-check"></i><span>Chúc mừng bạn đã hoàn
                                thành xong kpi "Haha"</span></a>
                        <a href="#"><i class="fa-solid fa-circle-exclamation"></i><span>Bạn đã không thực hiện "Học
                                UxUi"</span></a>
                        <a href="#"><i class="fa-solid fa-clock"></i><span>Còn 5 phút nữa tới giờ thực hiện "Chạy
                                bộ"</span></a>
                        <a href="#" class="active"><i class="fa-solid fa-circle-check"></i><span>Chúc mừng bạn đã hoàn
                                thành xong kpi "Haha"</span></a>
                        <a href="#"><i class="fa-solid fa-circle-exclamation"></i><span>Bạn đã không thực hiện "Học
                                UxUi"</span></a>
                    </div>
                </div>
            </div>

            <button class="right-item position-relative" id="avatar" onclick="showAvatarMenu()"><img id="avatar-img"
                    src="/src/images/avatar.jpg"></button>
            <ul id="avatar-menu">
                <li class="avatar-menu-item" id="preview-profile">
                    <img src="/src/images/avatar.jpg">
                    <div id="preview-infor">
                        <span>Lưu Việt Hoàn</span>
                        <span>viethoan557723@gmail.com</span>
                    </div>
                </li>
                <li class="avatar-menu-item"><a href="/src/view/profile.html"><i
                            class="fa-solid fa-user"></i><span>Thông tin cá nhân</span></a></li>
                <li class="avatar-menu-item"><a href="/src/view/setting.html"><i class="fa-solid fa-gear"></i><span>Cài
                            đặt</span></a></li>
                <li class="avatar-menu-item"><a href="/src/view/feedback.html"><i
                            class="fa-solid fa-message"></i><span>Góp ý nhà phát triển</span></a></li>
                <li class="avatar-menu-item"><a href="/src/view/landingpage.html"><i
                            class="fa-solid fa-right-from-bracket"></i><span>Đăng xuất</span></a></li>
            </ul>
        </div>
    </header>
    <!---------------------------------------------End Header------------------------------------------------->

    <!-------------------------------------------------Start main---------------------------------------------->
    <main>
        <div class="kpi-overview">
            <div class="chart1">
                <div class="chart1-header">
                    <p>Biểu đồ hiệu suất hoàn thành KPI</p>
                    <div class="next-prev-button">
                        <p class="month"></p>
                        <div class="np-button">
                            <button id="prevButton"><i class="fa-solid fa-arrow-left"></i></i></button>
                            <button id="nextButton"><i class="fa-solid fa-arrow-right"></i></button>
                        </div>
                    </div>
                </div>
                <canvas id="kpi-chart"></canvas>
            </div>
            <div class="chart2">
                <p>Tổng quan</p>
                <canvas id="kpi-chart2" width="200" height="200"></canvas>
                <p class="inline">
                    <span>
                        <div class="inline">
                            <div class="counter" id="dem-pt">
                                <p>0</p>
                            </div>
                            <span>%</span>
                        </div>
                    </span>nữa sẽ hoàn thành tất cả các kpi
                </p>
            </div>
        </div>
        <div class="achivement inline">
            <div class="number-of-day">
                <div class="inline">
                    <div class="counter" id="daysUsed">
                        <p>0</p>
                    </div>
                    <span>ngày</span>
                </div>
                <p>sử dụng KPiBara</p>
            </div>
            <div class="number-of-kpi">
                <div class="inline">
                    <div class="counter" id="kpiCompleted">
                        <p>0</p>
                    </div>
                    <span>KPI</span>
                </div>
                <p>đã hoàn thành</p>
            </div>
            <div class="rate-done">
                <div class="inline">
                    <div class="counter" id="kpiCompletedRate">
                        <p>0</p>
                    </div>
                    <span>%</span>
                </div>
                <p>tỉ lệ hoàn thành nhiệm vụ</p>
            </div>

        </div>
    </main>
    <!--------------------------------------------------End main----------------------------------------------->

    <!-------------------------------------------------Start footer-------------------------------------------->
    <footer>


    </footer>
    <!---------------------------------------------------End footer-------------------------------------------->

    <!-----------------------------------------------------Start Script---------------------------------------->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://kit.fontawesome.com/78f639c5ca.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/src/js/main.js"></script>
    <script>
        // Giả sử mảng kpiData chứa dữ liệu cho các KPI
        // Giả lập dữ liệu cho 12 tháng
        function getVietnameseMonthName(monthIndex) {
            const monthNames = [
                'Tháng Một', 'Tháng Hai', 'Tháng Ba', 'Tháng Bốn', 'Tháng Năm', 'Tháng Sáu',
                'Tháng Bảy', 'Tháng Tám', 'Tháng Chín', 'Tháng Mười', 'Tháng Mười Một', 'Tháng Mười Hai'
            ];
            return monthNames[monthIndex];
        }

        // Giả sử dữ liệu mới cho mỗi tháng
        const fakeData = {
            'Tháng Một': [5, 10, 15, 20, 25, 30, 35, 40, 45, 50],
            'Tháng Hai': [10, 20, 30, 40, 50, 60, 70, 80, 90, 100],
            'Tháng Ba': [20, 15, 10, 5, 30, 25, 20, 15, 10, 5],
            'Tháng Bốn': [25, 30, 35, 40, 45, 50, 55, 60, 65, 70],
            'Tháng Năm': [30, 35, 40, 45, 50, 55, 60, 65, 70, 75],
            // ... thêm dữ liệu giả định cho các tháng khác
        };

        function updateChartData(chartInstance, newData) {
            chartInstance.data.datasets.forEach((dataset) => {
                dataset.data = newData; // Gán dữ liệu mới cho biểu đồ
            });
            chartInstance.update(); // Cập nhật biểu đồ để hiển thị dữ liệu mới
        }

        let currentMonth = new Date().getMonth(); // Lấy tháng hiện tại (0-11)
        let currentYear = new Date().getFullYear(); // Lấy năm hiện tại

        function updateChartAndDateDisplay(chartInstance) {
            const monthName = getVietnameseMonthName(currentMonth);
            const newChartData = fakeData[monthName]; // Lấy dữ liệu giả định dựa trên tháng

            // Cập nhật dữ liệu biểu đồ
            updateChartData(chartInstance, newChartData);

            // Cập nhật hiển thị tháng/năm
            document.querySelector('.month').textContent = `${monthName} ${currentYear}`;
        }
        // Lắng nghe sự kiện click cho nút trước
        document.getElementById('prevButton').addEventListener('click', function () {
            if (currentMonth === 0) {
                currentMonth = 11; // Quay lại tháng cuối cùng của năm trước
                currentYear--; // Giảm năm
            } else {
                currentMonth--; // Giảm tháng
            }
            updateChartAndDateDisplay(myChart);
        });

        // Lắng nghe sự kiện click cho nút sau
        document.getElementById('nextButton').addEventListener('click', function () {
            if (currentMonth === 11) {
                currentMonth = 0; // Chuyển sang tháng đầu tiên của năm sau
                currentYear++; // Tăng năm
            } else {
                currentMonth++; // Tăng tháng
            }
            updateChartAndDateDisplay(myChart);
        });

        // Cấu hình biểu đồ
        const config = {
            type: 'bar',
            data: {
                labels: [10, 20, 30, 40, 50, 60, 70, 80, 90, 100], // Phần trăm hoàn thành cho trục ngang
                datasets: [{
                    label: 'Số lượng KPI',
                    data: [2, 3, 5, 1, 6, 4, 2, 3, 4, 1], // Số lượng KPI cho mỗi phần trăm hoàn thành
                    backgroundColor: 'rgba(234,76,137, 0.5)',
                    borderColor: 'rgba(234,76,137, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                indexAxis: 'x', // Chuyển trục ngang thành trục dọc
                scales: {
                    x: {
                        beginAtZero: true, // Bắt đầu trục ngang từ 0
                        title: {
                            display: true,
                            text: 'Phần trăm hoàn thành (%)' // Tiêu đề cho trục ngang
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Số lượng KPI' // Tiêu đề cho trục dọc
                        }
                    }
                }
            }
        };

        // Khởi tạo biểu đồ
        const myChart = new Chart(document.getElementById('kpi-chart'), config);

        // Cập nhật hiển thị tháng/năm lần đầu khi trang web tải xong
        updateChartAndDateDisplay(myChart);


        const canvas = document.getElementById('kpi-chart2');
        const context = canvas.getContext('2d');
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;
        const radius = 70;
        const fullCircle = Math.PI * 2;
        const quarterCircle = Math.PI / 2;

        // Phần trăm KPI đã hoàn thành
        let completedPercentage = 0; // Bắt đầu từ 0%
        const finalPercentage = 75; // Đích đến là 75%

        // Vẽ hình tròn rỗng
        function drawEmptyCircle() {
            context.beginPath();
            context.arc(centerX, centerY, radius, 0, fullCircle);
            context.lineWidth = 10;
            context.strokeStyle = '#e6e6e6';
            context.stroke();
        }

        // Vẽ phần trăm KPI đã hoàn thành
        function drawCompletedCircle() {
            context.beginPath();
            context.arc(centerX, centerY, radius, -quarterCircle, (fullCircle * completedPercentage / 100) - quarterCircle);
            context.lineWidth = 10;
            context.strokeStyle = '#EA4C89'; // Màu sắc cho phần đã hoàn thành
            context.stroke();
        }

        // Vẽ phần trăm bên trong hình tròn
        function drawPercentageText() {
            context.font = '20px Arial';
            context.textAlign = 'center';
            context.textBaseline = 'middle';
            context.fillText(completedPercentage + '%', centerX, centerY);
        }

        // Hàm hoạt hình
        function animate() {
            context.clearRect(0, 0, canvas.width, canvas.height); // Xóa canvas trước khi vẽ lại
            drawEmptyCircle();
            drawCompletedCircle();
            drawPercentageText();

            if (completedPercentage < finalPercentage) {
                completedPercentage++; // Tăng dần phần trăm đã hoàn thành
                requestAnimationFrame(animate); // Gọi lại hàm hoạt hình
            }
        }

        animate(); // Bắt đầu hoạt hình

        function animateValue(id, start, end, duration) {
            let obj = document.getElementById(id);
            let range = end - start;
            let minTimer = 50;
            let stepTime = Math.abs(Math.floor(duration / range));
            stepTime = Math.max(stepTime, minTimer);
            let startTime = new Date().getTime();
            let endTime = startTime + duration;
            let timer;

            function run() {
                let now = new Date().getTime();
                let remaining = Math.max((endTime - now) / duration, 0);
                let value = Math.round(end - (remaining * range));
                obj.innerHTML = value;
                if (value == end) {
                    clearInterval(timer);
                }
            }

            timer = setInterval(run, stepTime);
            run();
        }

        animateValue("daysUsed", 0, 365, 2000); // Thay đổi 365 bằng số ngày thực tế
        animateValue("kpiCompleted", 0, 189, 2000); // Thay đổi 20 bằng số KPI thực tế
        animateValue("kpiCompletedRate", 0, 95, 2000);
        animateValue("dem-pt", 0, 25, 2000);



    </script>
    <!------------------------------------------------------End Script----------------------------------------->


</body>





</html>